<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
  <title>Student Login â€“ Exam Portal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body { background: linear-gradient(145deg, #f0f4ff 0%, #e6edfa 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; }
    .glass-card { background: rgba(255,255,255,0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 20px 35px -10px rgba(0,0,0,0.1); }
    .loading-dots { display: inline-flex; align-items: center; gap: 6px; }
    .loading-dots span { width: 10px; height: 10px; background: #3b82f6; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
    .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
    .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes bounce { 0%,80%,100% { transform: scale(0); } 40% { transform: scale(1); } }
  </style>
</head>
<body class="font-sans antialiased p-4">
  <div class="glass-card w-full max-w-md rounded-3xl p-8">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-700 bg-clip-text text-transparent" data-i18n="appTitle">ðŸ“˜ Student Login</h1>
      <div class="flex space-x-2">
        <button onclick="setLanguage('en')" class="px-3 py-1 bg-white/80 text-blue-800 rounded-full text-sm font-medium shadow-sm">EN</button>
        <button onclick="setLanguage('hi')" class="px-3 py-1 bg-white/80 text-indigo-800 rounded-full text-sm font-medium shadow-sm">à¤¹à¤¿à¤‚à¤¦à¥€</button>
      </div>
    </div>

    <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="studentId">Student ID</label>
        <input type="text" id="studentId" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 bg-white/70" placeholder="e.g. 2024CS001" required>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="dob">Date of Birth (8 digits, DDMMYYYY)</label>
        <input type="text" id="dob" class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 bg-white/70" placeholder="01012005" maxlength="8" pattern="\d{8}" inputmode="numeric" required>
        <p class="text-xs text-gray-500 mt-1" data-i18n="dobHint">Exactly 8 digits, e.g. 01012005</p>
      </div>
      <button type="submit" id="loginBtn" class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-semibold py-3 px-4 rounded-xl transition flex items-center justify-center gap-2 shadow-lg">
        <span data-i18n="login">Login</span>
      </button>
    </form>

    <div class="mt-6 text-center">
      <a href="instructions.html" class="text-sm text-blue-600 hover:text-blue-800 transition">
        <i class="fas fa-question-circle mr-1"></i> <span data-i18n="needHelp">Need help?</span>
      </a>
    </div>

    <div id="message" class="mt-4 text-sm text-center hidden p-3 rounded-xl"></div>
  </div>

  <script>
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzE0QixUjsH8AWRUsXm_1_sCxrg3DWVLeN46hk4gYTPrhYO_Bzbmj5fDLlUqAeLcl1c/exec';
    const translations = {
      en: {
        appTitle: 'ðŸ“˜ Student Login', studentId: 'Student ID', dob: 'Date of Birth (8 digits, DDMMYYYY)',
        dobHint: 'Exactly 8 digits, e.g. 01012005', login: 'Login', needHelp: 'Need help?'
      },
      hi: {
        appTitle: 'ðŸ“˜ à¤›à¤¾à¤¤à¥à¤° à¤²à¥‰à¤—à¤¿à¤¨', studentId: 'à¤›à¤¾à¤¤à¥à¤° à¤†à¤ˆà¤¡à¥€', dob: 'à¤œà¤¨à¥à¤® à¤¤à¤¿à¤¥à¤¿ (8 à¤…à¤‚à¤•, DDMMYYYY)',
        dobHint: 'à¤¬à¤¿à¤²à¥à¤•à¥à¤² 8 à¤…à¤‚à¤•, à¤œà¥ˆà¤¸à¥‡ 01012005', login: 'à¤²à¥‰à¤— à¤‡à¤¨', needHelp: 'à¤®à¤¦à¤¦ à¤šà¤¾à¤¹à¤¿à¤?'
      }
    };
    let currentLang = 'en';

    function setLanguage(lang) {
      currentLang = lang;
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.dataset.i18n;
        if (translations[lang]?.[key]) {
          if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.placeholder = translations[lang][key];
          else el.innerText = translations[lang][key];
        }
      });
    }

    function showMessage(msg, isError = false) {
      const msgDiv = document.getElementById('message');
      msgDiv.classList.remove('hidden');
      msgDiv.className = `mt-4 text-sm text-center p-3 rounded-xl ${isError ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`;
      msgDiv.innerText = msg;
      setTimeout(() => msgDiv.classList.add('hidden'), 5000);
    }

    function showLoading(btn) {
      btn.disabled = true;
      btn.innerHTML = `<div class="loading-dots"><span></span><span></span><span></span></div>`;
    }

    function hideLoading(btn, originalText) {
      btn.disabled = false;
      btn.innerHTML = originalText;
    }

    async function handleLogin(event) {
      event.preventDefault();
      const id = document.getElementById('studentId').value.trim();
      const dob = document.getElementById('dob').value.trim();
      if (!id || !dob) return showMessage('Please fill all fields', true);
      if (dob.length !== 8) return showMessage('DOB must be exactly 8 digits', true);

      const btn = document.getElementById('loginBtn');
      const originalText = btn.innerHTML;
      showLoading(btn);

      try {
        const res = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'login', id, dob })
        });
        const data = await res.json();
        if (data.status === 'success') {
          localStorage.setItem('studentToken', data.token);
          localStorage.setItem('studentName', data.data.name);
          localStorage.setItem('studentId', data.data.id);
          showMessage('Login successful! Redirecting...');
          setTimeout(() => window.location.href = 'index.html', 1000);
        } else {
          showMessage(data.data, true);
          hideLoading(btn, originalText);
        }
      } catch (error) {
        showMessage('Network error. Please try again.', true);
        hideLoading(btn, originalText);
      }
    }

    window.onload = function() {
      setLanguage('en');
      if (localStorage.getItem('studentToken')) window.location.href = 'index.html';
    };
  </script>
</body>
</html>
